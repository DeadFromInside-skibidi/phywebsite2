<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Botanical Muse | Valentine Capture</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;1,400&family=JetBrains+Mono:wght@300&family=Outfit:wght@300;500&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        :root {
            --vellum-bg: #fdfaf6;
            --vellum-edge: #e9e2d5;
            --ink: #2d3436;
            --accent-petal: #d4a3a3;
            --accent-stem: #7b8e7e;
            --glass-shine: rgba(255, 255, 255, 0.4);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            background-color: #f2eee8;
            color: var(--ink);
            font-family: 'Outfit', sans-serif;
            min-height: 100vh;
            overflow-x: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Paper Grain Texture Filter */
        .grain-overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none;
            z-index: 999;
            opacity: 0.4;
            mix-blend-mode: multiply;
        }

        /* Layout */
        .main-container {
            position: relative;
            width: 90vw;
            max-width: 1000px;
            height: 80vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 10;
        }

        /* The Vellum Sheet */
        .vellum-sheet {
            position: relative;
            width: 100%;
            height: 100%;
            background: var(--vellum-bg);
            border: 1px solid var(--vellum-edge);
            box-shadow: 
                20px 20px 60px rgba(0,0,0,0.05),
                inset 0 0 100px rgba(233, 226, 213, 0.3);
            padding: 40px;
            display: flex;
            flex-direction: row;
            gap: 40px;
            transition: all 1s cubic-bezier(0.23, 1, 0.32, 1);
            backdrop-filter: blur(2px);
            overflow: hidden;
        }

        /* Pressed Flower Decor Elements */
        .botanical-decor {
            position: absolute;
            pointer-events: none;
            opacity: 0.7;
            filter: sepia(0.2) saturate(0.8);
        }

        .flower-1 { top: -20px; right: -20px; width: 150px; transform: rotate(15deg); }
        .flower-2 { bottom: -30px; left: -20px; width: 180px; transform: rotate(-10deg); }

        /* Camera Frame */
        .capture-zone {
            flex: 1.2;
            position: relative;
            border: 0.5px solid rgba(0,0,0,0.1);
            background: #fff;
            padding: 12px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.03);
            display: flex;
            flex-direction: column;
            transform: rotate(-1deg);
        }

        .viewfinder {
            width: 100%;
            height: 100%;
            object-fit: contain;
            background: #fff;
            filter: contrast(1.05) brightness(1.02) sepia(0.05);
            transition: opacity 0.5s ease;
        }

        .photo-canvas {
            display: none;
        }

        /* Note Section */
        .note-zone {
            flex: 0.8;
            display: flex;
            flex-direction: column;
            justify-content: center;
            padding: 20px;
            border-left: 1px solid rgba(0,0,0,0.05);
        }

        .label-mono {
            font-family: 'JetBrains Mono', monospace;
            font-size: 10px;
            text-transform: uppercase;
            letter-spacing: 2px;
            margin-bottom: 20px;
            color: var(--accent-stem);
        }

        .main-heading {
            font-family: 'Playfair Display', serif;
            font-size: 2.5rem;
            line-height: 1.1;
            margin-bottom: 30px;
            font-style: italic;
        }

        .note-content {
            font-family: 'Playfair Display', serif;
            font-size: 1.2rem;
            line-height: 1.6;
            color: #555;
            margin-bottom: 40px;
            position: relative;
        }

        .note-content::after {
            content: "";
            position: absolute;
            bottom: -20px;
            left: 0;
            width: 40px;
            height: 1px;
            background: var(--accent-petal);
        }

        /* Controls */
        .controls {
            margin-top: auto;
        }

        .btn-capture {
            background: none;
            border: 1px solid var(--ink);
            padding: 15px 30px;
            font-family: 'Outfit', sans-serif;
            text-transform: uppercase;
            letter-spacing: 3px;
            font-size: 11px;
            cursor: pointer;
            transition: all 0.4s ease;
            position: relative;
            overflow: hidden;
        }

        .btn-capture:hover {
            background: var(--ink);
            color: #fff;
        }

        /* States */
        .captured .viewfinder {
            filter: contrast(1.1) brightness(1.1) grayscale(0.2) sepia(0.1);
        }

        .loading-overlay {
            position: absolute;
            inset: 0;
            background: var(--vellum-bg);
            z-index: 100;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: opacity 1s ease;
            flex-direction: column;
        }

        .loader-text {
            font-family: 'Playfair Display', serif;
            font-style: italic;
            font-size: 1.5rem;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 1; }
        }

        /* Mobile Adjustments */
        @media (max-width: 768px) {
            .main-container { height: auto; margin: 20px 0; }
            .vellum-sheet { flex-direction: column; height: auto; padding: 20px; }
            .capture-zone { height: 40vh; min-height: 250px; flex: none; }
            .note-zone { border-left: none; border-top: 1px solid rgba(0,0,0,0.05); padding: 20px 0; }
        }

        /* Frame Footer Styles */
        .frame-footer {
            margin-top: 15px;
            width: 100%;
            text-align: left;
            border-top: 1px solid rgba(0,0,0,0.08);
            padding-top: 12px;
        }

        .meta-line {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.65rem;
            color: var(--ink);
            margin-bottom: 4px;
            letter-spacing: 0.5px;
        }

        .meta-label {
            color: var(--accent-stem);
            margin-right: 5px;
        }

        .frame-message {
            font-family: 'Playfair Display', serif;
            font-size: 0.85rem;
            line-height: 1.35;
            color: var(--ink);
            margin-top: 10px;
            font-style: italic;
            opacity: 0.9;
        }
    </style>
</head>
<body>

    <svg style="display: none;">
        <filter id="grainy">
            <feTurbulence type="fractalNoise" baseFrequency="0.65" numOctaves="3" stitchTiles="stitch" />
            <feColorMatrix type="saturate" values="0" />
            <feComponentTransfer>
                <feFuncR type="linear" slope="0.1" />
                <feFuncG type="linear" slope="0.1" />
                <feFuncB type="linear" slope="0.1" />
            </feComponentTransfer>
            <feComposite operator="in" in2="SourceGraphic" result="monoNoise" />
            <feBlend in="SourceGraphic" in2="monoNoise" mode="multiply" />
        </filter>
    </svg>

    <div class="grain-overlay">
        <svg width="100%" height="100%">
            <rect width="100%" height="100%" filter="url(#grainy)" opacity="0.15"></rect>
        </svg>
    </div>

    <div class="loading-overlay" id="loader">
        <div class="loader-text" id="loader-text">Preparing the garden...</div>
        <button class="btn-capture" id="start-btn" style="margin-top: 20px; display: none;">Open Eyes</button>
    </div>

    <main class="main-container">
        <div class="vellum-sheet" id="sheet">
            <!-- Decorative Elements -->
            <svg class="botanical-decor flower-1" viewBox="0 0 100 100" fill="none">
                <path d="M50 10 C55 40 80 45 90 50 C80 55 55 60 50 90 C45 60 20 55 10 50 C20 45 45 40 50 10" fill="#d4a3a3" fill-opacity="0.3"/>
                <path d="M50 20 L50 80 M20 50 L80 50" stroke="#7b8e7e" stroke-width="0.5" stroke-dasharray="2 2"/>
                <circle cx="50" cy="50" r="3" fill="#e9e2d5"/>
            </svg>
            <svg class="botanical-decor flower-2" viewBox="0 0 100 100" fill="none">
                <path d="M30 20 Q50 50 30 80" stroke="#7b8e7e" stroke-width="1" />
                <ellipse cx="35" cy="35" rx="10" ry="15" fill="#d4a3a3" fill-opacity="0.2" transform="rotate(-30 35 35)"/>
                <ellipse cx="40" cy="55" rx="8" ry="12" fill="#d4a3a3" fill-opacity="0.15" transform="rotate(20 40 55)"/>
            </svg>

            <section class="capture-zone">
                <video id="video" class="viewfinder" autoplay playsinline></video>
                <canvas id="canvas" class="photo-canvas"></canvas>
                <div id="result-img" class="viewfinder" style="display: none;"></div>
                <div class="frame-footer">
                    <div class="meta-line"><span class="meta-label">DATE:</span> 14.02.2026</div>
                    <div class="meta-line"><span class="meta-label">REFRACTED SUBJECT:</span> BEAUTIFUL</div>
                    <div class="frame-message">
                        Like light hitting a prism, you turn the ordinary into a spectrum of color. This moment is frozen in crystalline perfection. Happy Valentine's Day.
                    </div>
                </div>
            </section>

            <section class="note-zone">
                <div class="label-mono">2025-26</div>
                <h1 class="main-heading">A Portrait in Bloom.</h1>
                <div class="note-content" id="note-text">
                    Like a pressed flower kept between the pages of a favorite book, some moments are meant to be preserved forever. You are the grace in this wild garden.
                </div>
                
                <div class="controls" data-html2canvas-ignore="true">
                    <button class="btn-capture" id="capture-btn">Seal the Moment</button>
                </div>
            </section>
        </div>
    </main>

    <script>
        const video = document.getElementById('video');
        const canvas = document.getElementById('canvas');
        const resultImg = document.getElementById('result-img');
        const captureBtn = document.getElementById('capture-btn');
        const loader = document.getElementById('loader');
        const sheet = document.getElementById('sheet');
        const noteText = document.getElementById('note-text');
        const startBtn = document.getElementById('start-btn');
        const loaderText = document.getElementById('loader-text');

        const messages = [
            "The Valentine everybody deserves.",
            "A love letter to the self.",
            "Blooming in the quiet moments.",
            "Like a pressed flower kept between the pages of a favorite book, some moments are meant to be preserved forever. You are the grace in this wild garden.",
            "Captured in the soft light of February. A memory preserved in vellum and ink, delicate and enduring as the first bud of spring.",
            "Beauty, like a rare botanical specimen, is best kept close to the heart. This frame holds a soul in full bloom.",
            "In the language of flowers, you represent a love that never fades. Let this reflection stay timeless.",
            "Your soul is a garden where beautiful things grow.",
            "Stillness speaks the loudest language of love."
        ];

        // Initialize Camera
        async function initCamera() {
            // Set random text on load
            noteText.innerText = messages[Math.floor(Math.random() * messages.length)];

            if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
                loaderText.innerHTML = "Camera access requires HTTPS.<br>Cannot use file://";
                return;
            }

            try {
                const stream = await navigator.mediaDevices.getUserMedia({ 
                    video: { 
                        facingMode: 'user', 
                        width: { ideal: window.screen.width }, 
                        height: { ideal: window.screen.height } 
                    }, 
                    audio: false 
                });
                video.srcObject = stream;

                const audio = new Audio('song.mp3');
                audio.loop = true;
                audio.play().catch(e => console.log("Audio autoplay blocked:", e));

                setTimeout(() => {
                    loader.style.opacity = '0';
                    setTimeout(() => loader.remove(), 1000);
                }, 1500);
            } catch (err) {
                console.error("Camera access denied:", err);
                loaderText.innerHTML = "Please enable camera to proceed...";
            }
        }

        // Capture Action
        captureBtn.addEventListener('click', () => {
            if (captureBtn.innerText.toUpperCase().includes('SEAL')) {
                const context = canvas.getContext('2d');
                
                // Capture raw video frame (prevents stretching)
                canvas.width = video.videoWidth;
                canvas.height = video.videoHeight;
                
                context.drawImage(video, 0, 0, canvas.width, canvas.height);
                
                // Switch video for captured image
                const dataUrl = canvas.toDataURL('image/png');
                resultImg.style.backgroundImage = `url(${dataUrl})`;
                resultImg.style.backgroundSize = 'contain';
                resultImg.style.backgroundPosition = 'center';
                resultImg.style.backgroundRepeat = 'no-repeat';
                
                video.style.display = 'none';
                resultImg.style.display = 'block';
                
                // Stop camera stream
                if (video.srcObject) {
                    video.srcObject.getTracks().forEach(track => track.stop());
                }
                
                setTimeout(() => {
                    sheet.classList.add('captured');
                    
                    captureBtn.innerText = 'Download Keepsake';
                    captureBtn.style.borderColor = 'var(--accent-petal)';
                    captureBtn.style.color = 'var(--accent-petal)';
                }, 500);
                
                // Visual feedback
                sheet.style.transform = 'scale(0.98) rotate(0deg)';
                setTimeout(() => {
                    sheet.style.transform = 'scale(1) rotate(0deg)';
                }, 200);
            } else {
                // Download Logic
                html2canvas(sheet, {
                    scale: window.devicePixelRatio || 2,
                    backgroundColor: null,
                    useCORS: true
                }).then(canvas => {
                    const link = document.createElement('a');
                    link.download = 'botanical-valentine.png';
                    link.href = canvas.toDataURL('image/png');
                    link.click();
                });
            }
        });

        // Start
        window.addEventListener('load', () => {
            loaderText.innerText = "Tap to enter";
            startBtn.style.display = 'block';
        });

        startBtn.addEventListener('click', () => {
            startBtn.style.display = 'none';
            loaderText.innerText = "Preparing the garden...";
            initCamera();
        });

        // Parallax Effect
        document.addEventListener('mousemove', (e) => {
            const x = (window.innerWidth / 2 - e.pageX) / 50;
            const y = (window.innerHeight / 2 - e.pageY) / 50;
            sheet.style.boxShadow = `${x}px ${y}px 60px rgba(0,0,0,0.05)`;
        });
    </script>
</body>
</html>
